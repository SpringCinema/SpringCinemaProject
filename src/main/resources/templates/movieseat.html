<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function() {

            // 인원 수 선택 이벤트
            // 인원 수 선택 시 금액 출력
            $(`input[name='inputAdt']`).on('click', function () {
                let count = $(`input[type='checkbox']:checked`).length;
                let adtVal = parseInt($(`input[name='inputAdt']:checked`).val());
                let teenVal = parseInt($(`input[name='inputTeen']:checked`).val());
                let adtCost = adtVal * 10000;
                let teenCost = teenVal * 5000;

                if(count > (adtVal + teenVal)) {
                    // 좌석 선택 후 인원 변경 시 좌석 제거
                    alert('좌석수가 인원수보다 많습니다.');
                    $(`input[type='checkbox']`).prop('checked', false);
                    $('#p-i-seatCode').html(`<p class="mb-1" id="p-i-seatCode">좌석 : </p>`);
                    $(`#p-i-cost`).html('<p class="mb-1">금액 : <b>' + (adtCost + teenCost) + '원</b></p>');
                }
                else {
                    // 선택된 인원에 따른 금액 출력
                    if((adtCost + teenCost) > 0) {
                        $(`#p-i-cost`).html('<p class="mb-1">금액 : <b>' + (adtCost + teenCost) + '원</b></p>');
                    }
                    else {
                        $(`#p-i-cost`).text('금액 : ');
                    }
                }
            });

            // 인원 수 선택 시 금액 출력
            $(`input[name='inputTeen']`).on('click', function () {
                let count = $(`input[type='checkbox']:checked`).length;
                let adtVal = parseInt($(`input[name='inputAdt']:checked`).val());
                let teenVal = parseInt($(`input[name='inputTeen']:checked`).val());
                let adtCost = adtVal * 10000;
                let teenCost = teenVal * 5000;

                if(count > (adtVal + teenVal)) {
                    // 좌석 선택 후 인원 변경 시 좌석 제거
                    alert('좌석수가 인원수보다 많습니다.');
                    $(`input[type='checkbox']`).prop('checked', false);
                    $('#p-i-seatCode').html(`<p class="mb-1" id="p-i-seatCode">좌석 : </p>`);
                    $(`#p-i-cost`).html('<p class="mb-1">금액 : <b>' + (adtCost + teenCost) + '원</b></p>');
                }
                else {
                    // 선택된 인원에 따른 금액 출력
                    if((adtCost + teenCost) > 0) {
                        $(`#p-i-cost`).html('<p class="mb-1">금액 : <b>' + (adtCost + teenCost) + '원</b></p>');
                    }
                    else {
                        $(`#p-i-cost`).text('금액 : ');
                    }
                }
            });


            // 좌석 선택 이벤트
            // 선택한 인원수 보다 많은 좌석 선택 시 오류 메세지 출력
            $(`input[type='checkbox']`).on('click', function () {
                let count = $(`input[type='checkbox']:checked`).length;
                let adtVal = parseInt($(`input[name='inputAdt']:checked`).val());
                let teenVal = parseInt($(`input[name='inputTeen']:checked`).val());
                let popNum = adtVal + teenVal;

                if (count > popNum) {
                    // 좌석 수가 더 많을 경우 체크박스 클릭 해제
                    $(this).prop('checked', false);
                    alert('선택 인원보다 많은 좌석은 선택할 수 없습니다.');
                }
                else {
                    if(count == 0) {
                        $('#p-i-seatCode').html(`<p class="mb-1" id="p-i-seatCode">좌석 : </p>`);
                    }
                    else {
                        // 체크된 좌석 값 출력
                        $('#p-i-seatCode').html(`<p class="mb-1" id="p-i-seatCode">좌석 : </p>`);
                        $(`input[type='checkbox']`).each(function (index) {
                            if($(this).is(":checked")==true){
                                $('#p-i-seatCode p').append($(this).val() + "|");
                            }
                        });
                    }
                }
            });
        });
    </script>

    <style>
        .container {
            width: 1300px;
            max-width: none !important;
        }

        .label-c-btn {
            background-color: lightgray;
        }

        .btn-success {
            background-color: #3CB371;
        }

        .div-c-seatInfo1 {
            background-color: #3CB371;
            width: 20px;
        }

        .div-c-seatInfo2 {
            background-color: #81CEA3;
            width: 20px;
        }

        .div-c-seatInfo3 {
            background-color: dimgray;
            width: 20px;
        }


    </style>
</head>
<body>
<!-- 헤더부분 -->
<header class="container">임시 헤더입니다.<br><hr><br></header>

<!-- 메인부분 -->
<main class="container">
    <div class="col-10 mx-auto mt-5 border">
        <div class="bg-dark text-light text-center m-0 mx-auto">
            <p class="m-0">인원/좌석</p>
        </div>
        <div class="row mx-1">
            <div class="col-6 border-end">
<!--                성인 관람 인원 선택 부분 -->
                <div class="my-1 mt-3">
                    <p class="m-0">일반 : 10,000원(1인)</p>
                    <div class="row text-center">
                        <div class="col-sm-1 me-1" th:each="item, i : ${people}">
                            <input type="radio" class="btn-check" name="inputAdt" th:id="'input-i-adt' + ${item}" th:if="${i.index} == 0" th:value="${item}" checked>
                            <input type="radio" class="btn-check" name="inputAdt" th:id="'input-i-adt' + ${item}" th:unless="${i.index} == 0" th:value="${item}">
                            <label class="btn btn-outline-secondary label-c-btn" th:for="'input-i-adt' + ${item}" th:text="${item}"></label>
                        </div>
                    </div>
                </div>
<!--                청소년 관람 인원 선택 부분-->
                <div class="mt-2">
                    <p class="m-0">청소년 : 5,000원(1인)</p>
                    <div class="row text-center">
                        <div class="col-sm-1 me-1" th:each="item, i : ${people}">
                            <input type="radio" class="btn-check" name="inputTeen" th:id="'input-i-teen' + ${item}" th:if="${i.index} == 0" th:value="${item}" checked>
                            <input type="radio" class="btn-check" name="inputTeen" th:id="'input-i-teen' + ${item}" th:unless="${i.index} == 0" th:value="${item}">
                            <label class="btn btn-outline-secondary label-c-btn" th:for="'input-i-teen' + ${item}" th:text="${item}"></label>
                        </div>
                    </div>
                </div>
            </div>
<!--            내가 선택한 티켓 정보 출력 부분 -->
            <div class="col-6">
                <div class="my-1 mt-3">
                    <p class="mb-1">영화제목 : </p>
                    <p class="mb-1">상영관 : </p>
                    <p class="mb-1">상영시간 : </p>
                    <p class="mb-1" id="p-i-seatCode">좌석 : </p>
                    <p class="mb-1" id="p-i-cost">금액 : </p>
                </div>

                <div class="text-end">
                    <button class="btn text-light mb-2" style="background-color: #FF4500">결제하기</button>
                </div>
            </div>
        </div>

<!--        좌석 선택 부분-->
        <div class="border-top">
            <div class="bg-secondary text-light mx-auto mt-5 col-7">
                <p class="text-center">SCREEN</p>
            </div>
            <div class="text-center w-75 mx-auto my-2">
<!--                타임리프 반복문으로 좌석 코드 알파벳 부분 불러옴 (좌석 번호 부분도 코드 생략 가능한지 더 고민해봐야 함)-->
                <div class="row" th:each="item, i : ${alp}">
                    <div class="col-1 border-end mb-2">
                        <button class="btn disabled border-0" th:text="${i.current}"></button>
                    </div>
                    <div class="col-11 row mb-2">
                        <div class="col-3 p-0 div-c-seat ms-2">
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '1'" th:value="${item} + '1'">
                            <label class="btn btn-success" th:for="'input-i-' + ${item} + '1'">1</label>
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '2'" th:value="${item} + '2'">
                            <label class="btn btn-success" th:for="'input-i-' + ${item} + '2'">2</label>
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '3'" th:value="${item} + '3'">
                            <label class="btn btn-success" th:for="'input-i-' + ${item} + '3'">3</label>
                        </div>

                        <div class="col-5 p-0 div-c-seat">
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '4'" th:value="${item} + '4'" disabled>
                            <label class="btn btn-success" th:for="'input-i-' + ${item} + '4'">4</label>
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '5'" th:value="${item} + '5'">
                            <label class="btn btn-success" th:for="'input-i-' + ${item} + '5'">5</label>
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '6'" th:value="${item} + '6'">
                            <label class="btn btn-success" th:for="'input-i-' + ${item} + '6'">6</label>
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '7'" th:value="${item} + '7'">
                            <label class="btn btn-success" th:for="'input-i-' + ${item} + '7'">7</label>
                        </div>

                        <div class="col-3 p-0 div-c-seat">
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '8'" th:value="${item} + '8'">
                            <label class="btn btn-success" th:for="'input-i-' + ${item} + '8'">8</label>
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '9'" th:value="${item} + '9'">
                            <label class="btn btn-success" th:for="'input-i-' + ${item} + '9'">9</label>
                            <input type="checkbox" class="btn-check" th:id="'input-i-' + ${item} + '10'" th:value="${item} + '10'" disabled>
                            <label class="ps-2 btn btn-dark" th:for="'input-i-' + ${item} + '10'" style="width: 35.8px"><p class="m-0">10</p></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="my-3">
            <div class="row mx-auto w-50 border">
                <div class="row col-4 ms-1 my-1">
                    <div class="col-6 div-c-seatInfo1 me-1"></div>
                    <p class="col-6 m-0 p-0">일반석</p>
                </div>
                <div class="row col-4 ms-1 my-1">
                    <div class="col-6 div-c-seatInfo2 me-1"></div>
                    <p class="col-6 m-0 p-0">예매석</p>
                </div>
                <div class="row col-4 ms-1 my-1">
                    <div class="col-6 div-c-seatInfo3 me-1"></div>
                    <p class="col-6 m-0 p-0">미판매석</p>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 푸터부분 -->
<footer class="container"><br><hr><br>임시 푸터입니다.</footer>
</body>
</html>