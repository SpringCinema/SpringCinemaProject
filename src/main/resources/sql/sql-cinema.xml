<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.esc.springcinema.mapper.CinemaMapper">
<!--    내 정보 불러오는 쿼리 -->
    <select id="selectMyInfo" resultType="com.esc.springcinema.dto.MemberDto">
        SELECT * FROM members
        WHERE id = #{id}
    </select>

<!--    내 정보 수정 쿼리 -->
    <update id="updateMyInfo" parameterType="com.esc.springcinema.dto.MemberDto">
        UPDATE members SET pwd = #{pwd}, name = #{name}, email = #{email}, tel = #{tel}
        WHERE id = #{id}
    </update>

<!--    회원 탈퇴 쿼리 -->
    <update id="deleteAccount" parameterType="com.esc.springcinema.dto.MemberDto">
        UPDATE members SET out_date = NOW()
        WHERE id = #{id} AND pwd = #{pwd}
    </update>

<!--    비밀번호 중복 확인 쿼리 -->
    <select id="checkPwd" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM members
        WHERE id = #{id} AND pwd = #{pwd}
    </select>

<!--    예매페이지에서 선택된 영화 정보 불러오는 쿼리-->
    <select id="selectScreenData" resultType="com.esc.springcinema.dto.ScreenHallDto">
        SELECT * FROM screen_hall
        WHERE cinema_name = #{cinemaName} AND screen_hall_name = #{screenHallName} AND movie_title = #{movieTitle}
    </select>

<!--    예매페이지에서 screen_hall 정보 불러오는 쿼리-->
    <select id="allScreenTitle" resultType="com.esc.springcinema.dto.ScreenHallDto">
        SELECT DISTINCT movie_title FROM screen_hall ORDER BY movie_title
    </select>



    <select id="isUserId" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM members WHERE id = #{targetId}
    </select>

    <select id="login" parameterType="String" resultType="com.esc.springcinema.dto.MemberDto">
        SELECT id, name FROM members WHERE id = #{targetId} AND pwd = #{pwd}
    </select>

    <insert id="createMember" parameterType="com.esc.springcinema.dto.MemberDto">
        INSERT INTO members(id, pwd, name, birth, gender, email, tel, join_date)
        VALUES(#{id}, #{pwd}, #{name}, #{birth}, #{gender}, #{email}, #{tel},
               NOW())
    </insert>

    <select id="selectNowplayingMoviesList" resultType="com.esc.springcinema.dto.MoviesDto">
        <![CDATA[
            SELECT title, SUBSTRING_INDEX(posters, '|', 1) AS posters
            FROM movies
            WHERE repRlsDate <= NOW()
        ]]>
    </select>
</mapper>